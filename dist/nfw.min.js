!function(nfw){var AppName="myapp",StateChangeDelegates=[],StateChangeTimestamps={},TopicDelegates={};nfw.StateDelegate=class{static setNamespace(appName){AppName=appName,localStorage.setItem(nfw.StateDelegate.getBucketName(),JSON.stringify({}))}static observeAll(callback){StateChangeDelegates.push(callback);const index=StateChangeDelegates.length-1;return()=>{index>=StateChangeDelegates.length||(StateChangeDelegates[index]=null)}}static observe(topic,callback){if("*"==topic)return nfw.StateDelegate.observeAll(callback);{TopicDelegates.hasOwnProperty(topic)||(TopicDelegates[topic]=[]),TopicDelegates[topic].push(callback);const index=TopicDelegates[topic].length-1;return()=>{index>=TopicDelegates[topic].length||(TopicDelegates[topic][index]=null)}}}static setState(topic,data){let stateBucket=nfw.StateDelegate.getStateBucket();try{const prevStateSerial=JSON.stringify(stateBucket);if(stateBucket[topic]=data,prevStateSerial==JSON.stringify(stateBucket)){const nextTimestamp=Date.now();if(nextTimestamp-(StateChangeTimestamps[topic]||nextTimestamp-1e3)<20)return void console.log(`ignoring redundant state change for topic ${topic}`)}StateChangeTimestamps[topic]=Date.now(),localStorage.setItem(nfw.StateDelegate.getBucketName(),JSON.stringify(stateBucket))}catch(e){return void console.error(`local storage write failed: ${e}`)}const topicCallbacks=TopicDelegates[topic]||[],allCallbacks=StateChangeDelegates.concat(topicCallbacks);for(var x=0;x<allCallbacks.length;x++)try{if(!allCallbacks[x])continue;allCallbacks[x].apply(null,[topic,stateBucket])}catch(e){console.log(`attempt to set state for topic ${topic}`),console.error(`delegate invocation failed: ${e}`)}}static getState(topic){let stateBucket=nfw.StateDelegate.getStateBucket();try{return stateBucket[topic]||{}}catch(e){return console.warn(`cannot extract topic ${topic} from state bucket: ${e}`),{}}}static getStateBucket(){try{let serializedBucket=localStorage.getItem(nfw.StateDelegate.getBucketName())||JSON.stringify({});return JSON.parse(serializedBucket)}catch(e){return console.error(`cannot deserialize state bucket: ${e}`),{}}}static getBucketName(){return`nfw-local-state-${AppName}`}}}(window.nfw=window.nfw||{}),function(nfw){nfw.HeadlessComponent=class{constructor(componentId){componentId?(this.id=componentId,this.initialize()):console.error("cannot instantiate component without id")}initialize(){}setState(state){nfw.StateDelegate.setState(this.id,state)}handleStateChange(componentName,newState){}observe(target){return console.log(`${this.id} is observing ${target}`),target==this.id?(console.warn(`cannot observe self: ${this.id}`),()=>{}):nfw.StateDelegate.observe(target,this.handleStateChange.bind(this))}}}(window.nfw=window.nfw||{}),function(nfw){nfw.ViewComponent=class extends nfw.HeadlessComponent{initialize(){}hasValidDom(requiredIdList=[]){if(1!=this.getElement().length)return console.warn(`view component requires unique dom node with id ${this.id}`),!1;for(var x=0;x<requiredIdList.length;x++){const id=requiredIdList[x];if(1!=$("#"+id).length)return console.warn(`view component requires unique dom node with id ${id}`),!1}return!0}getElement(){try{return $("#"+this.id)}catch(e){return[]}}},nfw.ViewComponent.isViewComponentClass=!0}(window.nfw=window.nfw||{}),function(nfw){nfw.AppController=class{constructor(appName){this.appNamespace=appName,nfw.StateDelegate.setNamespace(appName),nfw.StateDelegate.observeAll(this.handleStateChange.bind(this)),this.createViewComponents(),console.log(`${this.appNamespace} is ready`)}handleStateChange(topic,newStateData){console.log(`${topic} state change`)}createViewComponents(){this.components={};var component=null;window.hasOwnProperty(this.appNamespace)||(window[this.appNamespace]={});const classNameList=Object.keys(window[this.appNamespace]);for(var x=0;x<classNameList.length;x++){const className=classNameList[x];window[this.appNamespace][className].isViewComponentClass&&((component=new window[this.appNamespace][className](className)).hasValidDom()?(console.log(`${className} component created`),this.components[className]=component):(component=null,console.warn(`cannot create component with class ${className}`)))}}}}(window.nfw=window.nfw||{});